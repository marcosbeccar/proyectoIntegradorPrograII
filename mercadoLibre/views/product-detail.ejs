<!DOCTYPE html>
<html lang="es">
<!-- Include Head -->
<%- include ('./partials/head') %>
<body>
    <!-- Header -->
    <% if (cookies.userLogueado !== undefined || locals.userSession !== undefined) { %>
		<%- include('./partials/headerLogueado') %>
	<% } else { %>
		<%- include('./partials/header') %>
	<% } %>
    <!-- /Header -->

    <!-- product detail -->
    <div class="container products-wrapper">
        <div class="d-flex align-items-center">
            <h2 class="products-title"><%= producto.nombreProducto %></h2>
            <p class="product-detail-description">
                <a href="http://localhost:3000/product/agregarProducto">Editar</a>
            </p>
        </div>
        <div class="product-detail">
            <div class="row">
                <article class="col-12 col-lg-8 product-detail-info">
                    <img src="/images/<%= producto.rutaImagen %>" alt="" class="product-detail-img">
                    <p class="product-detail-description">
                        <%= producto.descripcionProducto %>
                    </p>
                </article>
                <div class="col-12 col-lg-4">
                    <section class="comments">
                        <% producto.comentarios.forEach(comentario => { %>
                            <article>
                                <img src="/images/<%= comentario.usuario.foto_perfil %>">
                                <div class="data">
                                    <p class="user">
                                        <strong> <a href="http://localhost:3000/user/<%= comentario.usuario.id %>"><%= comentario.usuario.usuario %> </a> </strong>
                                        <%= comentario.comentario %>
                                    </p>
                                </div>
                            </article>
                        <% }); %>
                    </section>

                    <!--mostrar errores-->
                    <% if (locals.errors) { %> <!--Solo si errors existe (locals.errors=errors)-->
                        <% errors.forEach(error => { %>
                            <!--forEach es una especie de for loop, va a mostrar un <p> por error-->
                            <p class="mensajes-error">
                                <%= error.msg %>
                            </p>
                        <% }) %>
                    <% } %>
                    <!--===========================================================================-->

                    <% if (userSession || cookies.userLogueado) { %>
                        <form class="form" action="/comment/<%= producto.id %>" method="POST">
                            <input class="form-input" type="text" value="<%= locals.old && old.comentario ? old.comentario : '' %>" placeholder="Agregar comentario" name="comentario">
                            <button type="submit" class="buy-now-button">AGREGAR COMENTARIO</button>
                        </form>
                    <% } else { %>
                        <h3>Debes <a href="/user/iniciarSesion" style="color: blue">iniciar sesi√≥n</a> para agregar un comentario.</h3>
                    <% } %>
                    <hr>
                </div>
            </div>
        </div>
    </div>
    <!-- /product detail -->

    <!-- footer -->
    <%- include ('./partials/footer') %>
    <!-- /footer -->

</body>
</html>